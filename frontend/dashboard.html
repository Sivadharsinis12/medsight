<!DOCTYPE html>
<html>
<head>
<title>Clinical Insights Dashboard</title>
<link rel="stylesheet" href="css/style.css">
<style>
.dashboard-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-top: 30px;
}

.dashboard-full {
  grid-column: 1 / -1;
}

.stats {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: white;
  padding: 24px;
  border-radius: 14px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
}

.stat-card p {
  color: #64748b;
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 8px;
}

.stat-card h2 {
  font-size: 32px;
  color: #2563eb;
}

.patient-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 8px;
  margin-top: 15px;
}

.patient-table thead {
  background: #f8fafc;
}

.patient-table th {
  padding: 14px;
  text-align: left;
  font-weight: 600;
  color: #475569;
  border-bottom: 2px solid #e2e8f0;
}

.patient-table td {
  padding: 14px;
  background: white;
  border-top: 1px solid #e2e8f0;
  border-bottom: 1px solid #e2e8f0;
  font-size: 14px;
}

.patient-table tr:hover td {
  background: #f8fafc;
}

.badge {
  padding: 5px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.high { background: #fee2e2; color: #b91c1c; }
.moderate { background: #fef3c7; color: #92400e; }
.low { background: #dcfce7; color: #166534; }

.insight-card {
  padding: 20px;
}

.insight-card h4 {
  color: #334155;
  margin-bottom: 10px;
  font-size: 15px;
}

.insight-card p {
  color: #64748b;
  font-size: 14px;
  line-height: 1.6;
}

.confidence-bar {
  height: 10px;
  background: #e2e8f0;
  border-radius: 10px;
  margin-top: 12px;
  overflow: hidden;
}

.confidence-fill {
  height: 100%;
  background: linear-gradient(90deg, #2563eb, #3b82f6);
  border-radius: 10px;
  transition: width 0.3s ease;
}
</style>
</head>
<body>

<div class="navbar">
  <div class="logo">MedInsight AI</div>
  <div class="nav-links">
    <a href="dashboard.html" class="active">Dashboard</a>
    <a href="upload.html">Analyze</a>
    <a href="history.html">History</a>
  </div>
</div>

<div class="container">
  <h1>Clinical Insights Dashboard</h1>
  <p class="subtitle">View patient analysis results and insights</p>

  <!-- STATS CARDS -->
  <div class="stats">
    <div class="stat-card">
      <p>Total Patients</p>
      <h2 id="totalPatients">0</h2>
    </div>
    <div class="stat-card">
      <p>High-Risk Patients</p>
      <h2 id="highRisk">0</h2>
    </div>
    <div class="stat-card">
      <p>Detected Anomalies</p>
      <h2 id="anomalies">0</h2>
    </div>
    <div class="stat-card">
      <p>System Health</p>
      <h2 id="health">100%</h2>
    </div>
  </div>

  <!-- PATIENT TABLE -->
  <div class="card dashboard-full">
    <h3>Patient Overview</h3>
    <table class="patient-table">
      <thead>
        <tr>
          <th>Patient</th>
          <th>Category</th>
          <th>Department</th>
          <th>Risk Level</th>
          <th>Analysis Time</th>
        </tr>
      </thead>
      <tbody id="patientTable"></tbody>
    </table>
  </div>

  <!-- INSIGHTS GRID -->
  <div class="dashboard-grid">
    <div class="card insight-card">
      <h4>Observations</h4>
      <p id="observationsText">No anomalies detected.</p>
    </div>

    <div class="card insight-card">
      <h4>Risk Factors</h4>
      <p id="riskFactorsText">Low baseline risk.</p>
    </div>

    <div class="card insight-card">
      <h4>Pattern Deviations</h4>
      <p id="patternText">Stable trends.</p>
    </div>

    <div class="card insight-card">
      <h4>Recommendations</h4>
      <p id="recommendationText">No immediate action required.</p>
    </div>

    <div class="card insight-card">
      <h4>Preventive Care</h4>
      <p>Scheduled Wellness Check</p>
    </div>

    <div class="card insight-card">
      <h4>Insights Confidence</h4>
      <div class="confidence-bar">
        <div class="confidence-fill" id="confidenceBar" style="width: 0%"></div>
      </div>
      <p style="margin-top: 8px; font-weight: 600;" id="confidenceText">0%</p>
    </div>
  </div>

</div>

<script>
// Fetch uploaded data
const records = JSON.parse(localStorage.getItem("records")) || [];
const historyData = JSON.parse(localStorage.getItem("analysisHistory")) || [];

document.getElementById("totalPatients").innerText = records.length;

let highRisk = 0;
let mediumRisk = 0;
let anomalies = 0;

// Calculate from actual data
records.forEach(r => {
  let risk = "low";
  let badgeClass = "low";

  if(r.category === "Radiology") {
    risk = "high";
    badgeClass = "high";
    highRisk++;
    anomalies++;
  }
  else if(r.category === "Lab Report") {
    risk = "moderate";
    badgeClass = "moderate";
    mediumRisk++;
  }

  const table = document.getElementById("patientTable");
  table.innerHTML += `
    <tr>
      <td>${r.patient}</td>
      <td>${r.category}</td>
      <td>${r.dept}</td>
      <td><span class="badge ${badgeClass}">${risk.toUpperCase()}</span></td>
      <td>${r.time}</td>
    </tr>
  `;
});

document.getElementById("highRisk").innerText = highRisk;
document.getElementById("anomalies").innerText = anomalies;

// System Health Calculation based on actual data
let health = 100;
if (records.length > 0) {
  health = 100 - (highRisk * 15) - (mediumRisk * 5);
  if (health < 50) health = 50;
}
document.getElementById("health").innerText = health + "%";

// Calculate confidence from actual data
let confidence = 0;
if (records.length > 0) {
  // Base confidence from number of records
  let baseConfidence = Math.min(50, records.length * 10);
  
  // Adjust based on risk distribution
  let riskFactor = 50;
  if (highRisk > 0) riskFactor = 30;
  else if (mediumRisk > 0) riskFactor = 40;
  
  confidence = baseConfidence + riskFactor;
  confidence = Math.min(99, confidence); // Cap at 99%
}

document.getElementById("confidenceBar").style.width = confidence + "%";
document.getElementById("confidenceText").innerText = confidence + "%";

// Update observations based on actual data
if (anomalies > 0) {
  document.getElementById("observationsText").innerText = 
    anomalies + " anomaly pattern" + (anomalies > 1 ? "s" : "") + " detected in recent records.";
  document.getElementById("riskFactorsText").innerText = 
    highRisk + " high-risk and " + mediumRisk + " medium-risk case" + (highRisk + mediumRisk > 1 ? "s" : "") + " require attention.";
  document.getElementById("patternText").innerText = 
    records.length + " total record" + (records.length > 1 ? "s" : "") + " analyzed successfully.";
  document.getElementById("recommendationText").innerText = 
    highRisk > 0 ? "Immediate review recommended for high-risk patients." : "Continue regular monitoring.";
} else if (records.length === 0) {
  document.getElementById("observationsText").innerText = "No records analyzed yet.";
  document.getElementById("riskFactorsText").innerText = "Upload patient records to begin analysis.";
  document.getElementById("patternText").innerText = "Waiting for data.";
  document.getElementById("recommendationText").innerText = "Go to Analyze to upload records.";
}

</script>

</body>
</html>
